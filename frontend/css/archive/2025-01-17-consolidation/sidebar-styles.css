/**
 * Sidebar Styles - Consolidated
 * Single source of truth for all sidebar-related styles
 * Includes: layout, sticky positioning, toggle buttons
 * 
 * Z-INDEX HIERARCHY:
 * - Sidebar content (.topic-list, .toc-sidebar): 100
 * - Sidebar headers (.sidebar-header): 110
 * - Toggle buttons in headers: 120
 * - Fixed toggle buttons: 900
 * - Header (from app-unified.css): 1000
 */

/* ============================================
   SIDEBAR LAYOUT & STICKY POSITIONING
   ============================================ */

/* Sidebar containers - Matrix style with laser animation */
.sidebar-container {
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    background-color: #020402;
    border-right: 1px solid #0d832d;
    transition: width 1.2s cubic-bezier(0.86, 0, 0.07, 1);
}

#left-sidebar {
    grid-area: left-sidebar;
    width: var(--sidebar-width);
    border-right: 1px solid #0d832d;
}

#right-sidebar {
    grid-area: right-sidebar;
    width: var(--toc-width);
    border-left: 1px solid #0d832d;
    border-right: none;
}

/* Laser shine effect */
.shine-effect {
    position: absolute;
    top: 0;
    width: 4px;
    height: 100%;
    z-index: 150;
    opacity: 0;
    background: linear-gradient(
        to bottom,
        transparent 0%,
        #26ed65 5%,
        #0d832d 15%,
        transparent 30%
    );
    background-size: 100% 200%;
    background-position: 0% 0%;
    box-shadow: 0 0 10px 5px rgba(38, 237, 101, 0.9);
    transition: opacity 0.5s ease-in-out;
    pointer-events: none;
}

#left-sidebar .shine-effect { 
    left: calc(100% - 2px); 
    transform: translateX(-50%);
}

#right-sidebar .shine-effect {
    left: 0;
    transform: translateX(-50%);
}

.shine-effect.active {
    opacity: 1;
    animation: laser-scan 1.2s linear forwards;
}

@keyframes laser-scan {
    0% { background-position: 0% 0%; }
    100% { background-position: 0% 100%; }
}

/* Collapsed state - Matrix style */
.sidebar-container.collapsed {
    width: 25px;
}

#left-sidebar.collapsed {
    width: 25px;
}

#right-sidebar.collapsed {
    width: 25px;
}

/* Content fade effect during collapse */
.sidebar-content {
    transition: opacity 0.5s ease-in-out;
    transition-delay: 0.5s;
}

.sidebar-container.collapsed .sidebar-content {
    opacity: 0;
    pointer-events: none;
    transition-delay: 0s;
}

/* Handle legacy .hidden class with higher specificity */
.sidebar-container#left-sidebar.hidden,
.sidebar-container#right-sidebar.hidden {
    width: 25px;
    display: block; /* Higher specificity instead of !important */
}

/* Sticky sidebar content */
.topic-list,
.toc-sidebar {
    position: sticky;
    position: -webkit-sticky;
    /* Align with section tabs: header (60px) + tabs (60px) = 120px */
    top: calc(var(--header-height) + var(--section-tabs-height));
    height: calc(100vh - var(--header-height) - var(--section-tabs-height));
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    overflow-y: auto;
    overflow-x: hidden;
    z-index: var(--z-sidebars, 100); /* Default to 100 if var not defined */
}

.topic-list {
    border-right: 1px solid var(--border-color);
}

.toc-sidebar {
    border-left: 1px solid var(--border-color);
}

/* Sidebar headers */
.sidebar-header {
    position: sticky;
    top: 0;
    background: var(--bg-tertiary);
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-color);
    z-index: 110; /* Higher than sidebar content (100) */
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-title {
    font-family: var(--font-family);
    color: var(--primary-green);
    font-size: 1.2rem;
    margin: 0;
    text-shadow: 0 0 10px var(--primary-green);
}

/* ============================================
   TOGGLE BUTTONS
   ============================================ */

/* Base toggle button styles - inside headers */
.sidebar-toggle,
#left-sidebar-toggle,
#right-sidebar-toggle {
    /* Sizing */
    width: 35px;
    height: 35px;
    
    /* Appearance */
    background: transparent;
    border: none;
    color: var(--primary-green);
    font-size: 1.8rem;
    
    /* Layout */
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* Interaction */
    cursor: pointer;
    opacity: 0.8;
    transition: all 0.3s ease;
    
    /* Glowing triangle effect */
    text-shadow: 0 0 10px var(--primary-green),
                 0 0 20px var(--primary-green),
                 0 0 30px rgba(0, 255, 65, 0.5);
    
    /* Ensure visibility */
    visibility: visible;
    position: relative;
    z-index: 120; /* Higher than sidebar header (110) */
    pointer-events: auto;
    
    /* Prevent shrinking */
    flex-shrink: 0;
    margin: 0;
    padding: 0;
    
    /* Animation */
    animation: glow-pulse 2s ease-in-out infinite;
}

@keyframes glow-pulse {
    0%, 100% { 
        opacity: 0.8; 
        transform: scale(1);
    }
    50% { 
        opacity: 1; 
        transform: scale(1.1);
    }
}

/* Hover state */
.sidebar-toggle:hover,
#left-sidebar-toggle:hover,
#right-sidebar-toggle:hover {
    opacity: 1;
    transform: scale(1.2);
    text-shadow: 0 0 15px var(--primary-green),
                 0 0 30px var(--primary-green),
                 0 0 45px rgba(0, 255, 65, 0.8);
    animation: none;
}

/* Active state */
.sidebar-toggle:active,
#left-sidebar-toggle:active,
#right-sidebar-toggle:active {
    transform: scale(0.95);
}

/* Button positioning - mirrored */
#left-sidebar .sidebar-header #left-sidebar-toggle {
    order: 2; /* Right side */
    margin-left: auto;
}

#right-sidebar .sidebar-header #right-sidebar-toggle {
    order: -1; /* Left side */
    margin-right: auto;
}

/* Fixed position buttons for collapsed sidebars */
.sidebar-toggle-fixed {
    position: fixed;
    width: 45px;
    height: 45px;
    top: calc(var(--header-height) + 20px);
    background: rgba(26, 26, 26, 0.9);
    border: 2px solid var(--primary-green);
    border-radius: var(--radius-md);
    color: var(--primary-green);
    font-size: 2rem;
    display: none; /* Hidden by default */
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: var(--z-toggle-buttons, 900); /* High z-index for fixed buttons */
    
    /* Glowing effect */
    box-shadow: 0 0 20px rgba(0, 255, 65, 0.5),
                inset 0 0 10px rgba(0, 255, 65, 0.2);
    text-shadow: 0 0 10px var(--primary-green),
                 0 0 20px var(--primary-green),
                 0 0 30px rgba(0, 255, 65, 0.5);
    
    transition: all 0.3s ease;
    animation: glow-pulse 2s ease-in-out infinite;
}

#left-sidebar-toggle-fixed {
    left: 10px;
}

#right-sidebar-toggle-fixed {
    right: 10px;
}

.sidebar-toggle-fixed:hover {
    background: rgba(0, 255, 65, 0.1);
    transform: scale(1.15);
    box-shadow: 0 0 30px rgba(0, 255, 65, 0.8),
                inset 0 0 15px rgba(0, 255, 65, 0.3);
    text-shadow: 0 0 15px var(--primary-green),
                 0 0 30px var(--primary-green),
                 0 0 45px rgba(0, 255, 65, 0.8);
    animation: none;
}

/* Show fixed buttons when sidebars are hidden */
.left-sidebar-hidden #left-sidebar-toggle-fixed {
    display: flex;
}

.right-sidebar-hidden #right-sidebar-toggle-fixed {
    display: flex;
}

/* ============================================
   STICKY POSITIONING FIXES
   ============================================ */

/* 
 * Overflow rules for sticky positioning
 * Using specific selectors for higher specificity without !important
 */

/* Fix overflow hierarchy - sticky requires visible overflow on parents */
html:root {
    overflow-y: visible;
    overflow-x: hidden;
}

body {
    overflow: visible;
    min-height: 100vh;
}

div#app-container {
    overflow: visible;
    min-height: 100vh;
    /* Ensure grid container doesn't restrict children */
    position: relative;
}

/* Content area must not restrict sticky sidebars */
main#content-area {
    overflow: visible;
    /* Remove any height restrictions */
    height: auto;
    min-height: 0;
}

/* Only the actual content display area should scroll */
div#content-display {
    /* This is the ONLY element that should scroll */
    overflow-y: auto;
    overflow-x: hidden;
    /* Match the sidebar height for consistent scrolling */
    height: calc(100vh - var(--header-height) - var(--section-tabs-height));
    /* Ensure content is scrollable */
    min-height: 0;
}

/* Ensure section tabs are properly positioned */
#section-tabs {
    /* Stick below header */
    position: sticky;
    top: var(--header-height);
    z-index: 80; /* Below sidebar content but above regular content */
    background: var(--bg-secondary); /* Ensure it's not transparent */
}

/* ============================================
   BROWSER COMPATIBILITY
   ============================================ */

/* For browsers that don't support :has() selector */
@supports not selector(:has(*)) {
    /* Use body classes for grid adjustments */
    .left-sidebar-hidden #app-container {
        grid-template-columns: 0 1fr var(--toc-width);
    }
    
    .right-sidebar-hidden #app-container {
        grid-template-columns: var(--sidebar-width) 1fr 0;
    }
    
    .left-sidebar-hidden.right-sidebar-hidden #app-container {
        grid-template-columns: 0 1fr 0;
    }
}

/* Mobile responsive */
@media (max-width: 768px) {
    .sidebar-toggle-fixed {
        opacity: 1;
        pointer-events: auto;
        display: flex;
    }
    
    .sidebar-toggle {
        /* Keep header buttons visible on mobile */
        opacity: 1;
    }
    
    /* Mobile sidebars overlay instead of push */
    #left-sidebar,
    #right-sidebar {
        position: fixed;
        top: var(--header-height);
        bottom: 0;
        z-index: 100;
        width: 280px;
    }
    
    #left-sidebar {
        left: 0;
        transform: translateX(-100%);
    }
    
    #right-sidebar {
        right: 0;
        transform: translateX(100%);
    }
    
    #left-sidebar:not(.hidden) {
        transform: translateX(0);
    }
    
    #right-sidebar:not(.hidden) {
        transform: translateX(0);
    }
}